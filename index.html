<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>টাইমড কুইজ সিস্টেম</title>
    <style>
        :root { --primary: #1a73e8; --success: #28a745; --danger: #dc3545; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f8f9fa; display: flex; justify-content: center; padding: 20px; }
        .quiz-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 500px; width: 100%; }
        h1 { text-align: center; color: var(--primary); }
        .form-group { margin-bottom: 15px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
        .btn:hover { background: #1557b0; }
        .timer-bar { height: 10px; background: #eee; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .timer-progress { height: 100%; background: var(--danger); width: 100%; transition: width 1s linear; }
        .question { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; }
        .option { display: block; background: #fff; border: 2px solid #eee; margin: 10px 0; padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .option:hover { border-color: var(--primary); }
        .selected { background: #e8f0fe !important; border-color: var(--primary) !important; }
        #quiz-section, #result-section { display: none; }
        .time-text { text-align: right; font-weight: bold; color: var(--danger); margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="auth-section">
        <h1>কুইজ রেজিস্ট্রেশন</h1>
        <div class="form-group">
            <input type="text" id="student-name" placeholder="আপনার নাম লিখুন">
        </div>
        <div class="form-group">
            <input type="text" id="student-wa" placeholder="আপনার WhatsApp নম্বর">
        </div>
        <button class="btn" onclick="startQuiz()">পরীক্ষা শুরু করুন</button>
        <p id="loading-msg" style="text-align:center; display:none;">প্রশ্ন লোড হচ্ছে...</p>
    </div>

    <div id="quiz-section">
        <div class="time-text">সময় বাকি: <span id="time-left">30</span> সেকেন্ড</div>
        <div class="timer-bar"><div id="progress" class="timer-progress"></div></div>
        <div class="question" id="question"></div>
        <div id="options"></div>
        <button class="btn" id="next-btn" style="margin-top:20px;">পরের প্রশ্ন</button>
    </div>

    <div id="result-section">
        <h1>ফলাফল</h1>
        <p id="final-stats" style="text-align:center; font-size: 1.2rem;"></p>
        <button class="btn" onclick="location.reload()">আবার শুরু করুন</button>
    </div>
</div>

<script>
    // আপনার গুগল শিট লিঙ্ক (Day 1)
    const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRz139u6UTqfYp_H_IERxQVMwfcVCNp8ChVdZFV4S-RD1D3p6fQT7iV38BtQ9NSJGeWMkbWYOSQtrW5/pub?gid=0&single=true&output=csv";

    let quizData = [];
    let currentIndex = 0;
    let score = 0;
    let timer;
    let timeLeft = 30;
    let selectedAns = "";

    // ডেটা ফেচ করা
    async function loadSheetData() {
        document.getElementById('loading-msg').style.display = 'block';
        try {
            const res = await fetch(sheetUrl + "&cb=" + Date.now());
            const text = await res.text();
            const rows = text.split(/\r?\n/).slice(1);
            quizData = rows.map(r => {
                const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return { q: c[0], a: c[1], b: c[2], c: c[3], d: c[4], correct: c[5]?.trim().toLowerCase() };
            }).filter(item => item.q);
            document.getElementById('loading-msg').style.display = 'none';
        } catch (e) { alert("শিট থেকে ডেটা আনতে সমস্যা হয়েছে!"); }
    }

    async function startQuiz() {
        const name = document.getElementById('student-name').value;
        const wa = document.getElementById('student-wa').value;
        
        if(!name || !wa) { alert("নাম ও নম্বর দুটিই দিন!"); return; }
        
        await loadSheetData();
        if(quizData.length === 0) return;

        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('quiz-section').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        if(currentIndex >= quizData.length) { endQuiz(); return; }
        
        selectedAns = "";
        timeLeft = 30;
        updateTimerUI();
        
        const data = quizData[currentIndex];
        document.getElementById('question').innerText = `${currentIndex + 1}. ${data.q}`;
        document.getElementById('options').innerHTML = `
            <div class="option" onclick="selectOpt('a', this)">A) ${data.a}</div>
            <div class="option" onclick="selectOpt('b', this)">B) ${data.b}</div>
            <div class="option" onclick="selectOpt('c', this)">C) ${data.c}</div>
            <div class="option" onclick="selectOpt('d', this)">D) ${data.d}</div>
        `;

        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            updateTimerUI();
            if(timeLeft <= 0) handleNext();
        }, 1000);
    }

    function updateTimerUI() {
        document.getElementById('time-left').innerText = timeLeft;
        const percent = (timeLeft / 30) * 100;
        document.getElementById('progress').style.width = percent + "%";
    }

    window.selectOpt = (val, el) => {
        selectedAns = val;
        document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
    };

    document.getElementById('next-btn').onclick = handleNext;

    function handleNext() {
        if(selectedAns === quizData[currentIndex].correct) score++;
        currentIndex++;
        showQuestion();
    }

    function endQuiz() {
        clearInterval(timer);
        document.getElementById('quiz-section').style.display = 'none';
        document.getElementById('result-section').style.display = 'block';
        const name = document.getElementById('student-name').value;
        document.getElementById('final-stats').innerHTML = `নাম: ${name}<br>আপনার স্কোর: ${score} / ${quizData.length}`;
    }
</script>

</body>
</html>
